---
ms.openlocfilehash: 9d60b23a3992d883e52781398b393f71aa74d2ee
ms.sourcegitcommit: 8773c31cceaa4d9a36c62c964a2b414c6e0656f3
ms.translationtype: HT
ms.contentlocale: ar-SA
ms.lasthandoff: 08/13/2021
ms.locfileid: "7457529"
---
عند تشغيل مكوّن إضافي (أو ملحق سير عمل مخصص)، يتم توفير الكثير من البيانات من خلال Microsoft Dataverse التي تحتوي على معلومات حول السياق الذي توجد فيه العملية الحالية. تتمتع كلّ من المكونات الإضافية وتجميعات سير العمل المخصصة بإمكانية الوصول إلى الفئة IWorkflowContext، والتي يمكن الوصول إليها من خلال أساليب مختلفة.

في المكونات الإضافية، يمكن الوصول إلى *IPluginExecutionContext* من خلال المعلمة *IServiceProvider* للأسلوب *Execute* عن طريق استدعاء الأسلوب *GetService*.

```c#
public class SamplePlugin : IPlugin

{

public void Execute(IServiceProvider serviceProvider)

{

// Obtain the execution context from the service provider.

IPluginExecutionContext context = (IPluginExecutionContext)

serviceProvider.GetService(typeof(IPluginExecutionContext));

}

}
```

في ملحقات سير العمل المخصصة، يتم تمرير *IPluginExecutionContext* كمعلمة للأسلوب *Execute* من النوع *CodeActivityContext*.

```c#
public class SampleWorkflowExtension : CodeActivity

{

protected override void Execute(CodeActivityContext context)

{

// Obtain the execution context from the code activity context.

IWorkflowContext workflowContext = context.GetExtension();

}

}
```

يقوم كل من *IPluginExecutionContext* و *IWorkflowContext* بتنفيذ الواجهة *IExecutionContext*. يعرض كل منها أيضاً معلومات خاصة بنوعها. لمزيد من المعلومات، راجع [فهم سياق التنفيذ](/powerapps/developer/common-data-service/understand-the-data-context/?azure-portal=true).

## <a name="iexecutioncontext-properties"></a>خصائص IExecutionContext

اثنان من أكثر الخصائص المميزة لواجهة *IExecutionContext* هما *InputParameters* و *OutputParameters*. أما الخصائص المستخدمة باستمرار الأخرى فهي *PreEntityImages* و *PostEntityImages* و *SharedVariables*.

### <a name="inputparameters"></a>InputParameters

يتم تضمين معلمات الإدخال في مجموعة InputParameters في سياق التنفيذ وهي من النوع *الكيان*. تتيح لك هذه الخاصية معرفة قيَم الكيانات التي تم تقديمها إلى المكون الإضافي قبل تنفيذ عملية معينة.

فمثلاُ، إذا كنت تريد التحقق من صحة بياناتك ومنع حفظها إذا لم ينجح التحقق من الصحة، فستكون الخطوات التي تتخذها مشابهة لما يلي:

1.  قم بتسجيل المكون الإضافي الخاص بك للتشغيل في مرحلة التحقق المسبق في إنشاء الكيان الذي تريد التحقق من صحته و / أو تحديثه.

2.  تحقق من صحة البيانات في المكون الإضافي الخاص بك عن طريق قراءة القيَم من مجموعة InputParameters. عند إنشاء، سترغب في استرداد المجموعة "الهدف".

3.  قم بإظهار InvalidPluginExecutionException إذا كانت البيانات المقدّمة غير صالحة.

أو ربما ترغب في تحديث القيَم في الكيان الخاص بك (مثل إزالة الأحرف الخاصة من رقم الهاتف) قبل حفظ البيانات. يمكنك التعامل مع هذا الموقف من خلال الخطوات التالية:

1.  قم بتسجيل المكون الإضافي الخاص بك للتشغيل في مرحلة PreOperation عند إنشاء الكيان الذي تريد تحديثه و / أو تحديثه.

2.  قم بتحديث البيانات في المكون الإضافي الخاص بك عن طريق تحرير القيَم من مجموعة InputParameters. عند إنشاء، سترغب في استرداد المجموعة "الهدف".  

### <a name="outputparameters"></a>OutputParameters

يتم تضمين معلمات الإخراج في مجموعة OutputParameters في سياق التنفيذ وهي من النوع *الكيان*. يتم توفير معلمات الإخراج فقط بعد حدوث العملية المحددة. ستتمكن على هذا النحو من استخدام هذه المجموعة فقط عندما تتعامل مع الأحداث في المرحلة PostOperation. 

فمثلاً، إذا كنت تريد تغيير القيم التي تم إرجاعها بواسطة العملية، فيمكنك تعديلها باتباع الخطوات التالية:

1.  قم بتسجيل المكون الإضافي الخاص بك للتشغيل في المرحلة PostOperation عند إنشاء الكيان الذي تريد تحديثه و / أو تحديثه.

2.  قم بتحديث البيانات في المكون الإضافي الخاص بك عن طريق تحرير القيَم من مجموعة OutputParameters. لاحظ أنه عند إنشاء، سترغب في استرداد المجموعة "الهدف". 

### <a name="preentityimages-and-postentityimages"></a>PreEntityImages وPostEntityImages

يمكنك توفير نسخة غير قابلة للتغيير أو لقطة من البيانات، وذلك عند تسجيل المكونات الإضافية للتشغيل مقابل إطار عمل الحدث. يعد هذا مثالياً، خاصةً عندما تحتاج إلى الإشارة إلى قيَم البيانات قبل حدوث عملية ما أو بعدها، لأغراض منها على سبيل المثال التسجيل أو التدقيق المخصص. 

بينما يمكنك استرداد قيَم الكيانات باستخدام سياق المؤسسة من داخل مكوّن إضافي عن طريق طلب استرداد، فإن استخدام صور الكيان لإجراء هذه المهمة يكون أكثر كفاءة ويُنصح به بشدة. 

### <a name="sharedvariables"></a>SharedVariables

تتيح لك المتغيرات المشتركة تكوين البيانات التي يمكن تمريرها من مكوّن إضافي إلى خطوة تحدث لاحقاً في مسار التنفيذ. هناك استثناءات في بعض الأحيان لهذه القاعدة، بينما نوصي بشدة بتكوين المكونات الإضافية لتكون بدون حالة وليس لها أي تبعيات على الأحداث الخارجية. 

قد تحدث أحد الاستثناءات عندما تريد التأكد من عدم وجود أي مكونات إضافية "شاردة" داخل بيئتك، أي أنها يتم تنشيطها في إطار سيناريو متكرر بصورة لانهائية. يمكنك أيضاً استخدام سياق التنفيذ لتحديد العمق الذي يعمل به المكون الإضافي حالياً، ولكن في حالات معينة، قد يكون من المناسب التتبع يدوياً. فمثلاً، ربما يقوم المكون الإضافي الخاص بك ببدء تشغيل منطق التحديث عن طريق الخطأ داخل مكوّن إضافي تم تكوينه للتشغيل على تحديث الكيان، والذي بدوره يتسبب في تشغيله بلا حدود. يمكنك إنشاء نمط لحساب عدد المرات التي يمكن فيها تشغيل هذا المكون الإضافي، وذلك لاستكشاف هذه المشكلة وإصلاحها.
قد يكون من الأمثلة على ذلك تكوين حد يبلغ خمسة عمليات تشغيل للمكوّن الإضافي من خلال الخطوات التالية: 

1.  تحقق من وجود متغير RunCount المشترك في المكون الإضافي، وإلا، فقم بإنشاء متغير تمت تهيئته إلى الصفر.

2.  تحقق مما إذا كانت قيمة المتغير RunCount أكبر من خمسة، وإذا كانت كذلك، فقم بإظهار InvalidPluginExecutionException.

3.  في نهاية المكون الإضافي، قم بزيادة المتغير RunCount بمقدار 1. 

> [!NOTE]
> هذه مجرد حماية إضافية ضد الخطأ الذي يتسبب بطريق الخطأ في تجاوز المكونات الإضافية لمواردك. يجب أن تتأكد من إنشاء المكونات الإضافية الخاصة بك بطريقة لا يحدث فيها هذا السيناريو أبداً. تتطلب طرق الاسترداد الخاصة بهم موارد أكثر بكثير من هذه الطريقة وأكثر صعوبة في التشخيص، ورغم ذلك يوفر Dataverse أيضاً ضمانات لمنع المكونات الإضافية "الشاردة" مثل هذه.
 
